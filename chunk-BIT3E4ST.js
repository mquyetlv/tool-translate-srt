import{a as be,b as ze,c as Pe,d as ye,e as Me,f as we,g as Ve,h as Oe,i as Ee,j as Ne,k as Ie,l as Fe,m as De,n as ke}from"./chunk-L6TKLBLE.js";import"./chunk-O64M6JIR.js";import{A as ge,B as _e,C as he,D as ve,J as Ce,K as xe,L as Se,M as Te,a as Q,g as K,h as Y,i as Z,j as ee,p as se,q as pe,r as me,x as de,y as ue,z as fe}from"./chunk-JXY4UOWN.js";import{d as X,da as q,ea as J,la as te,oa as ne,pa as ie,ra as oe,ua as re,va as ae,xa as le,za as ce}from"./chunk-J37VGLPJ.js";import{Ac as $,E as D,Fb as d,H as k,Ha as L,Jb as A,L as M,Lb as w,Mb as V,Ob as b,Pb as z,Qb as i,Rb as o,Sb as g,Tb as U,Ub as j,W as G,Wb as C,ac as u,cc as f,fb as a,ha as S,mc as P,nc as c,o as y,oc as _,pc as x,sa as p,sb as R,ta as m,vc as O,wc as H,yb as T,yc as B,zc as W}from"./chunk-D2EZNFQM.js";import{a as N,b as I,e as F}from"./chunk-AP4OEWII.js";var Ge=[{code:"vi-VN",name:"Ti\u1EBFng Vi\u1EC7t"},{code:"zh-CN",name:"Ti\u1EBFng Trung Qu\u1ED1c ph\u1ED5 th\xF4ng"},{code:"en-US",name:"Ti\u1EBFng Anh M\u1EF9"}];var He=()=>({y:"350px"}),Be=()=>[5,10,20,50,100],We=r=>({active:r}),$e=(r,t)=>t.index;function Xe(r,t){if(r&1){let e=C();i(0,"div",9),g(1,"ion-icon",18),i(2,"div")(3,"h3"),c(4),o(),i(5,"span"),c(6),B(7,"number"),o()(),i(8,"ion-icon",19),u("click",function(){p(e);let l=f();return m(l.onRemoveFile())}),o()()}if(r&2){let e=f();a(4),_(e.file.name),a(2),x("",W(7,2,e.file.size/1024)," kb")}}function Qe(r,t){if(r&1){let e=C();g(0,"ion-icon",20),i(1,"div",21)(2,"h4",22),c(3,"Drag and drop a file into this area to upload"),o(),i(4,"span",23),c(5,"OR"),o()(),i(6,"button",24),u("click",function(){p(e),f();let l=P(31);return m(l.click())}),c(7," Select file "),o()}}function qe(r,t){if(r&1&&(i(0,"tr")(1,"td"),c(2),o(),i(3,"td"),c(4),o(),i(5,"td"),c(6),o(),i(7,"td"),c(8),o()()),r&2){let e=t.$implicit;a(2),_(e.index),a(2),_(e.startTime),a(2),_(e.endTime),a(2),_(e.text)}}function Je(r,t){if(r&1&&g(0,"nz-option",30),r&2){let e=t.$implicit;d("nzLabel",e.name)("nzValue",e.code)}}function Ke(r,t){if(r&1){let e=C();i(0,"div",34)(1,"div",35)(2,"h2"),c(3),o(),i(4,"span"),c(5),o(),i(6,"span"),c(7),o()(),i(8,"div",36)(9,"nz-icon",37),u("click",function(){let l=p(e).$implicit,s=f(2);return m(s.onPreviewVoice(l))}),o(),i(10,"nz-icon",38),u("click",function(){let l=p(e).$implicit,s=f(2);return m(s.onSelectVoice(l))}),o()()()}if(r&2){let e=t.$implicit,n=f(2);A(H(5,We,n.currentVoiceSelected.name===e.name)),a(3),_(e.name),a(2),x("Gender: ",e.ssmlGender===n.SsmlGenderEnum.MALE?"Male":"Female",""),a(2),x("Price: ",e.price||"Unknow ","$/1 Million Character")}}function Ye(r,t){if(r&1&&(U(0),i(1,"form",25)(2,"div",26)(3,"nz-input-group",27),g(4,"input",28),o()(),i(5,"div",26)(6,"nz-select",29),b(7,Je,1,2,"nz-option",30,V),o()()(),i(9,"h1",31),c(10,"VOICES:"),o(),i(11,"div",32),b(12,Ke,11,7,"div",33,V),o(),j()),r&2){let e=f(),n=P(35);a(),d("formGroup",e.searchVoiceForm),a(2),d("nzSuffix",n),a(3),d("nzAllowClear",!1),a(),z(e.LANGUAGE_CODES),a(5),z(e.voiceTypes)}}function Ze(r,t){r&1&&g(0,"nz-icon",39)}function et(r,t){if(r&1&&(i(0,"div",17),g(1,"nz-progress",40),o()),r&2){let e=f();a(),d("nzPercent",e.progress())("nzWidth",120)}}var Le=class r{fb=S(le);notificationService=S(ve);subtitleTranslationService=S(Fe);formData=this.fb.group({});searchVoiceForm=this.fb.group({name:this.fb.control(""),languageCode:this.fb.control("")});SsmlGenderEnum=be;LANGUAGE_CODES=Ge;voiceTypes=[];_voiceTypes=[];currentVoiceSelected={languageCodes:["vi-VN"],name:"vi-VN-Neural2-A",ssmlGender:2,naturalSampleRateHertz:24e3};file;isShowModalSelectVoice=!1;dataParsed=[];textPreview="Xin ch\xE0o, \u0111\xE2y l\xE0 h\u1EC7 th\u1ED1ng chuy\u1EC3n \u0111\u1ED5i v\u0103n b\u1EA3n th\xE0nh gi\u1ECDng n\xF3i";progress=L(0);isProcessing=!1;constructor(){this.getAllVoicesType(),this.searchVoiceForm.controls.languageCode.setValue("vi-VN")}ngOnInit(){this.onLanguageCodeChange(),this.handleTrackingProcess(),this.handleSearchVoice()}handleTrackingProcess(){return F(this,null,function*(){let t=new ke().withUrl(`${Ie.apiUrl}/Process`).configureLogging(De.Information).withAutomaticReconnect().build();try{yield t.start(),console.log("Connected in signalR!")}catch(e){this.notificationService.error("Hass error when tracking process: ",e.message)}t.on("ReceiveProcess",e=>{console.log("Process: ",e),this.progress.set(parseInt(e))})})}getAllVoicesType(){this.searchVoiceForm.get("languageCode")?.valueChanges.pipe(G(t=>t?this.subtitleTranslationService.getVoicesType(t).pipe(D(()=>y([]))):y([]))).subscribe(t=>{this.voiceTypes=t.map(e=>I(N({},e),{price:Ce(e.name)})).sort((e,n)=>(e.price||0)-(n.price||0)),this._voiceTypes=[...this.voiceTypes]})}onLanguageCodeChange(){this.searchVoiceForm.controls.languageCode.valueChanges.pipe(M()).subscribe(t=>{this.searchVoiceForm.get("name")?.setValue(""),t==="zh-CN"?this.textPreview="\u4F60\u597D\uFF0C\u8FD9\u662F\u4E00\u4E2A\u6587\u672C\u8F6C\u8BED\u97F3\u7CFB\u7EDF":t==="en-US"?this.textPreview="Hello, this is a text-to-speech system":this.textPreview="Xin ch\xE0o, \u0111\xE2y l\xE0 h\u1EC7 th\u1ED1ng chuy\u1EC3n \u0111\u1ED5i v\u0103n b\u1EA3n th\xE0nh gi\u1ECDng n\xF3i"})}uploadFile(t){let e=t.target,n=e.files;if(n?.length){if(n.length>1){alert("Vui l\xF2ng ch\u1EC9 upload 1 file");return}this.handleFile(n[0]),e.value=""}}onFileDropped(t){if(!t?.length)return;if(t.length>1){alert("Vui l\xF2ng ch\u1EC9 nh\u1EADp 1 file");return}let e=t[0];if(e.name&&!e.name.toLowerCase().endsWith(".srt")){this.notificationService.error("Error!","Please select only .srt files");return}this.handleFile(e)}handleFile(t){this.file=t,this.readFile(t)}onRemoveFile(){this.file=void 0,this.dataParsed=[]}readFile(t){if(!t)return;let e=new FileReader;e.onload=n=>{let l=n.target.result,s=this.parseSRT(l);this.dataParsed=s},e.readAsText(t)}parseSRT(t){return t.trim().split(/\r?\n\r?\n/).map(n=>{let l=n.split(/\r?\n/),s=parseInt(l[0]),[h,Re]=l[1].split(" --> "),Ae=l.slice(2).join(`
`),Ue=/(\d{2}):(\d{2}):(\d{2}),(\d{3})/,v=h.match(Ue),E=null;return v&&(E=parseInt(v[1],10)*60*60+parseInt(v[2],10)*60+parseInt(v[3],10)+parseInt(v[4],10)/1e3),{index:s,startTime:h,endTime:Re,text:Ae,second:E}})}handleCancel(){this.isShowModalSelectVoice=!1,this.searchVoiceForm.get("name")?.setValue("")}onSelectVoice(t){this.currentVoiceSelected=t,this.isShowModalSelectVoice=!1}onPreviewVoice(t){this.subtitleTranslationService.downloadPreviewVoice(this.textPreview,t).subscribe({next:e=>{let n=URL.createObjectURL(e.body),l=new Audio(n);l.play().catch(()=>console.log("Has error when play audio")),l.onended=()=>{URL.revokeObjectURL(n)}},error:e=>{console.log("Error: ",e)}})}onTranslateSubtitle(){this.isProcessing=!0,this.subtitleTranslationService.translateSubtitle(this.dataParsed,this.currentVoiceSelected).subscribe({next:t=>{let e=window.URL.createObjectURL(t.body),n=document.createElement("a");n.href=e,n.download="audio.wav",n.click(),window.URL.revokeObjectURL(e)},error:t=>{this.notificationService.error("Has Error:",t.message)},complete:()=>{this.isProcessing=!1,this.progress.set(0)}})}handleSearchVoice(){this.searchVoiceForm.get("name")?.valueChanges.pipe(M(),k(300)).subscribe(t=>{if(t){let e=this._voiceTypes.filter(n=>n.name.toLowerCase().includes(t.trim().toLowerCase()));this.voiceTypes=e}else this.voiceTypes=[...this._voiceTypes]})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=R({type:r,selectors:[["app-subtitle-translation"]],decls:37,vars:14,consts:[["rowSelectionTable",""],["uploadFileElement",""],["suffixIconSearch",""],[2,"display","flex","justify-content","space-between"],[1,"current-voice-selected",3,"click"],["nzType","down","nzTheme","outline"],["nz-button","","nzType","primary",3,"click","disabled"],[1,"upload-file",3,"formGroup"],["appDragDrop","",1,"box-upload","mt-4",3,"fileDropped"],[1,"file-info"],[1,"wrap-table"],["nzShowPagination","","nzShowSizeChanger","",3,"nzData","nzScroll","nzPageSizeOptions"],["nzWidth","100px"],["nzWidth","200px"],["type","file","accept",".srt",1,"d-none",3,"change"],["nzTitle","Select voice","nzWidth","1000px",3,"nzOnCancel","nzVisible","nzFooter","nzCentered"],[4,"nzModalContent"],[1,"model-process"],["name","document-outline",1,"icon-file"],["name","close-outline",1,"icon-delete",3,"click"],["name","cloud-upload-outline",1,"icon"],[1,"wrap-text"],[1,"text"],[1,"text-small"],[1,"button-upload",3,"click"],[1,"form-search-voice",3,"formGroup"],[1,"control-search-voice"],[3,"nzSuffix"],["type","text","nz-input","","placeholder","Enter voice name...","formControlName","name"],["nzShowSearch","","nzAllowClear","","nzPlaceHolder","Select language code","formControlName","languageCode",2,"width","100%",3,"nzAllowClear"],[3,"nzLabel","nzValue"],[1,"title"],[1,"voices"],[1,"voice",3,"class"],[1,"voice"],[1,"voice-info"],[1,"voice-action"],["nzType","play-circle","nzTheme","outline","nz-tooltip","Preview",1,"voice-action-icon",3,"click"],["nzType","swap","nzTheme","outline","nz-tooltip","Select voice",1,"voice-action-icon",3,"click"],["nzType","search"],["nzType","circle",3,"nzPercent","nzWidth"]],template:function(e,n){if(e&1){let l=C();i(0,"div",3)(1,"div",4),u("click",function(){return p(l),m(n.isShowModalSelectVoice=!n.isShowModalSelectVoice)}),i(2,"div")(3,"h3"),c(4),o(),i(5,"span"),c(6),o()(),g(7,"nz-icon",5),o(),i(8,"button",6),u("click",function(){return p(l),m(n.onTranslateSubtitle())}),c(9," Convert to voice "),o()(),i(10,"form",7)(11,"div",8),u("fileDropped",function(h){return p(l),m(n.onFileDropped(h))}),T(12,Xe,9,4,"div",9)(13,Qe,8,0),o()(),i(14,"div",10)(15,"nz-table",11,0)(17,"thead")(18,"tr")(19,"th",12),c(20,"NO"),o(),i(21,"th",13),c(22,"Start time"),o(),i(23,"th",13),c(24,"End time"),o(),i(25,"th"),c(26,"Text"),o()()(),i(27,"tbody"),b(28,qe,9,4,"tr",null,$e),o()()(),i(30,"input",14,1),u("change",function(h){return p(l),m(n.uploadFile(h))}),o(),i(32,"nz-modal",15),u("nzOnCancel",function(){return p(l),m(n.handleCancel())}),T(33,Ye,14,3,"ng-container",16),o(),T(34,Ze,1,0,"ng-template",null,2,$)(36,et,2,2,"div",17)}if(e&2){let l=P(16);a(4),_(n.currentVoiceSelected.name),a(2),x(" Gender: ",n.currentVoiceSelected.ssmlGender===n.SsmlGenderEnum.MALE?"Male":"Female"," "),a(2),d("disabled",!n.file||!n.currentVoiceSelected),a(2),d("formGroup",n.formData),a(2),w(n.file?12:13),a(3),d("nzData",n.dataParsed)("nzScroll",O(12,He))("nzPageSizeOptions",O(13,Be)),a(13),z(l.data),a(4),d("nzVisible",n.isShowModalSelectVoice)("nzFooter",null)("nzCentered",!0),a(4),w(n.isProcessing?36:-1)}},dependencies:[ce,oe,te,ne,ie,re,ae,Q,X,ee,Z,K,Y,Te,Se,xe,ge,de,fe,ue,J,q,me,se,pe,Pe,ze,Ne,Ve,ye,Me,Ee,we,Oe,he,_e],styles:[".box-upload[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:space-between;border:2px dashed #1890ff;height:200px;border-radius:12px;margin-top:16px;padding:30px 0}.box-upload[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:40px}.box-upload[_ngcontent-%COMP%]   .wrap-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.box-upload[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:18px}.box-upload[_ngcontent-%COMP%]   .text-small[_ngcontent-%COMP%]{font-size:14px;margin-top:6px;display:inline-block}.box-upload[_ngcontent-%COMP%]   .button-upload[_ngcontent-%COMP%]{background-color:transparent;outline:none;border:1px solid #ccc;border-radius:4px;padding:6px 14px}.file-info[_ngcontent-%COMP%]{margin:auto;display:flex;align-items:center}.file-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:21px;font-weight:600}.file-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;margin-top:4px}.file-info[_ngcontent-%COMP%]   .icon-delete[_ngcontent-%COMP%]{font-size:40px;color:red;margin-left:12px;cursor:pointer}.icon-file[_ngcontent-%COMP%]{font-size:46px}.form-search-voice[_ngcontent-%COMP%]{display:flex}.control-search-voice[_ngcontent-%COMP%]{flex:1}.control-search-voice[_ngcontent-%COMP%] + .control-search-voice[_ngcontent-%COMP%]{margin-left:24px}.voices[_ngcontent-%COMP%]{height:420px;overflow-y:scroll}.voices[_ngcontent-%COMP%]   .voice[_ngcontent-%COMP%]{border:1px solid #40a9ff;padding:12px;display:flex;justify-content:space-between;align-items:center;border-radius:4px}.voices[_ngcontent-%COMP%]   .voice[_ngcontent-%COMP%] + .voice[_ngcontent-%COMP%]{margin-top:8px}.voices[_ngcontent-%COMP%]   .voice.active[_ngcontent-%COMP%]{border-color:red;color:#40a9ff}.voices[_ngcontent-%COMP%]   .voice.active[_ngcontent-%COMP%]   .voice-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#40a9ff}.voices[_ngcontent-%COMP%]   .voice-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;font-size:12px;line-height:1.2}.voices[_ngcontent-%COMP%]   .voice-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin-bottom:4px}.voices[_ngcontent-%COMP%]   .voice-action-icon[_ngcontent-%COMP%]{font-size:24px;margin-left:12px;cursor:pointer}.voices[_ngcontent-%COMP%]   .voice-action-icon[_ngcontent-%COMP%]:hover{color:#40a9ff}.title[_ngcontent-%COMP%]{margin-top:32px;margin-bottom:6px;font-size:18px;font-weight:600}.wrap-table[_ngcontent-%COMP%]{margin-top:24px}.current-voice-selected[_ngcontent-%COMP%]{width:200px;display:flex;justify-content:space-between;border:1px solid #40a9ff;border-radius:4px;padding:6px 12px;cursor:pointer}.current-voice-selected[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:600}.current-voice-selected[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px}.model-process[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background-color:#00000026}"]})};export{Le as SubtitleTranslationComponent};
